import requests
from io import BytesIO
from typing import List
import pandas as pd

if 'data_loader' not in globals():
    from mage_ai.data_preparation.decorators import data_loader


@data_loader
def ingest_files(**kwargs) -> pd.DataFrame:
    dfs: List[pd.DataFrame] = []

    for year, month in [(2023, 3)]:
        url = f'https://github.com/mage-ai/datasets/raw/master/taxi/yellow/{year}/{month:02d}.parquet'
        response = requests.get(url)
        
        if response.status_code != 200:
            raise Exception(f"Failed to download: {url}, Status Code: {response.status_code}, Response: {response.text}")
        
        df = pd.read_parquet(BytesIO(response.content))
        dfs.append(df)

    return pd.concat(dfs, ignore_index=True)
